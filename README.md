# PostgreSQL first/last aggregate

This is a native PostgreSQL extension to support reading the first and last value of a group.

In comparison to partition's `FIRST_VALUE()` and `LAST_VALUE()`, it does only require groups.

The [original snippet](https://wiki.postgresql.org/wiki/First/last_%28aggregate%29) has been modified to work with newer PostgreSQL versions.

## Installation

Just run `first_last_aggregegate.sql` on your PostgreSQL console.

## Example
```sql
select
    product,
    first(price) price_open,
    last(price) price_close,
    avg(price) price_avg,
    min(price) price_min,
    max(price) price_max
from products
    group by product
```

| product | price\_open | price\_close | price\_avg | price\_min | price\_max |
| :--- | :--- | :--- | :--- | :--- | :--- |
| Affe | 9.272449 | 67.55699 | 52.32810068130493 | 9.272449 | 83.53931 |
| Kuh | 87.33832 | 20.83148 | 61.10811456044515 | 20.83148 | 97.54616 |
| Katze | 51.7085 | 50.019222 | 38.3283109664917 | 9.954079 | 51.7085 |

*Note: Data was generated by `test/test-data.sql`* 

### Use sort order in groups

If your group needs to be ordered before reading `first` and `last`, use [Aggregte expressions](https://www.postgresql.org/docs/current/sql-expressions.html#SYNTAX-AGGREGATES)

```sql
select
    max(time) end,
    min(time) start,
    product,
    first(price order by time) price_open,
    last(price order by time) price_close,
from products
    group by product
```
